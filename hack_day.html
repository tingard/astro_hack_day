<!DOCTYPE html> 
<html> 
<head> 
<meta charset=utf-8>
<title>My first Three.js app</title>
<style> body { margin: 0; } canvas { width: 100%; height: 100% } </style> 
<script style="text/javasript" src="js/PapaParse-4.1.2/papaparse.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r73/three.min.js"></script> 
<script src="http://astronomy.susx.ac.uk/~tl229/astro_hack_day/js/FlyControls.js"></script> 
</head> 
<body>

<script>

	var scene = new THREE.Scene();
	function async(arg, your_function, callback) {
		setTimeout(function() {
			your_function(arg);
			if (callback) {callback();}
		}, 0);
	}

	function coords_to_points(point_list){
		console.log('coords_to_points asyncronously called');
		for (i=0; i<5; i++){		
			var geometry = new THREE.BoxGeometry( 1, 1, 1 );
			var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } ); 
			var cube = new THREE.Mesh( geometry, material ); 
			cube.position.x = i //point_list[i][0];
			cube.position.y = i //point_list[i][1];
			scene.add( cube );
		}
	}
    
    var foo;
	Papa.parse("http://astronomy.sussex.ac.uk/~tl229/WP8_photoz_COSMOS.csv", {
		download: true,
		complete: function(results, foo) {
			foo = results.data;
			console.log(foo);
			async(foo, coords_to_points);
		}
	})
	function onWindowResize( event ) {
		SCREEN_HEIGHT = window.innerHeight;
		SCREEN_WIDTH  = window.innerWidth;
		renderer.setSize( SCREEN_WIDTH, SCREEN_HEIGHT );
		camera.aspect = SCREEN_WIDTH / SCREEN_HEIGHT;
		camera.updateProjectionMatrix();
		composer.reset();
	}
	/*
	window.addEventListener( 'resize', onWindowResize, false );
	var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
	camera.position.z = 5;
	container = document.createElement( 'div' );
	document.body.appendChild( container );
	controls = new THREE.FlyControls( camera );
	controls.movementSpeed = .5;
	controls.domElement = container;
	controls.rollSpeed = Math.PI / 24;
	controls.autoForward = false;
	controls.dragToLook = false;
	var renderer = new THREE.WebGLRenderer(); renderer.setSize( window.innerWidth, window.innerHeight );
	container.appendChild( renderer.domElement );
	function render() { requestAnimationFrame( render ); renderer.render( scene, camera ); } render();
	*/
	var dummy = new THREE.Object3D();
	var renderer = new THREE.WebGLRenderer({antialias: true});
	var viewport, controls;
	var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
	camera.position.z = 5;
	viewport = document.getElementById('viewport');
	//Sets up the renderer to the same size as a DOM element
	//then attaches it to that element
	function initilization() {
		renderer.setSize(viewportWidth, viewportHeight);
		document.getElementById('viewport').appendChild(renderer.domElement);

		controls = new THREE.FlyControls( camera, viewport );
		controls.movementSpeed = 0;
		controls.rollSpeed = Math.PI/24;
		controls.autoForward = false;
		controls.dragToLook = true;
		scene.add(dummy);
		dummy.add(camera);
		update();
	}
	function update(){
		controls.update(1);
		setTimeout( update, 16 );
		draw();
	}
	//----Draw----//
	function draw() {
		renderer.render(scene, camera);
	}
	initilization();
</script> 
</body>
</html>

