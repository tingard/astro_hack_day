<!DOCTYPE html> 
<html> 
<head> 
<meta charset=utf-8>
<title>My first Three.js app</title>
<style> body { margin: 0; } canvas { width: 100%; height: 100% } </style> 
<script style="text/javasript" src="js/PapaParse-4.1.2/papaparse.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r73/three.min.js"></script> 
<script src="http://astronomy.susx.ac.uk/~tl229/astro_hack_day/js/FlyControls.js"></script> 
<script>
	function async(arg, your_function, callback) {
		setTimeout(function() {
			your_function(arg);
			if (callback) {callback();}
		}, 0);
	}

	function coords_to_points(point_list){
		console.log('coords_to_points asyncronously called');
		for (i=0; i<5; i++){		
			var geometry = new THREE.BoxGeometry( 1, 1, 1 );
			var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } ); 
			var cube = new THREE.Mesh( geometry, material ); 
			cube.position.x = i //point_list[i][0];
			cube.position.y = i //point_list[i][1];
			scene.add( cube );
		}
	}
    
    var foo;
	Papa.parse("http://astronomy.sussex.ac.uk/~tl229/WP8_photoz_COSMOS.csv", {
		download: true,
		complete: function(results, foo) {
			foo = results.data;
			console.log(foo);
			async(foo, coords_to_points);
		}
	})
	
	function onWindowResize( event ) {
		SCREEN_HEIGHT = window.innerHeight;
		SCREEN_WIDTH  = window.innerWidth;
		renderer.setSize( SCREEN_WIDTH, SCREEN_HEIGHT );
		camera.aspect = SCREEN_WIDTH / SCREEN_HEIGHT;
		camera.updateProjectionMatrix();
	}
	var viewport;

	//built-in three.js controls will be attached to this
	var controls;

	//viewport size
	var viewportWidth = 800;
	var viewportHeight = 600;

	//camera attributes
	var view_angle = 45,
		aspect = viewportWidth / viewportHeight,
		near = 0.1,//near clip-plane
		far = 10000;//far clip-plane


	//----Constructors----//
	var renderer = new THREE.WebGLRenderer({antialias: true});
	var scene = new THREE.Scene();

	var camera = new THREE.PerspectiveCamera(
	view_angle,
	aspect,
	near,
	far
	);


	//a cross-browser method for efficient animation, more info at:
	// http://paulirish.com/2011/requestanimationframe-for-smart-animating/
	window.requestAnimFrame = (function(){
	  return  window.requestAnimationFrame       || 
			  window.webkitRequestAnimationFrame || 
			  window.mozRequestAnimationFrame    || 
			  window.oRequestAnimationFrame      || 
			  window.msRequestAnimationFrame     || 
			  function( callback ){
				window.setTimeout(callback, 1000 / 60);
			  };
	})();
	//----Initialization----//
	function initialize()
	{
		//Sets up the renderer to the same size as a DOM element
		//and attaches it to that element
		renderer.setSize(viewportWidth, viewportHeight);
		viewport = document.getElementById('viewport');
		viewport.appendChild(renderer.domElement);

		camera.position.set(0,0,200);

		//attaches fly controls to the camera
		controls = new THREE.FlyControls( camera );
		//camera control properties
		controls.movementSpeed = 1;
		controls.domElement = viewport;
		controls.rollSpeed = 0.01;
		controls.autoForward = false;
		controls.dragToLook = true;

		//add the objects to the scene
		scene.add(camera);

		// call update
		update();
	}
	//----Update----//
	function update() {
		//requests the browser to call update at it's own pace
		requestAnimFrame( update );

		//update controls
		controls.update( 1 );

		//call draw
		draw();
	}
	//----Draw----//
	function draw() {
		renderer.render(scene, camera);
	}
	window.addEventListener( 'resize', onWindowResize, false );

</script> 
</head>
<body onload="initialize();">
<div id="viewport"></div>
</body>
</html>

